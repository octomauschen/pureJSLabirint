<!DOCTYPE html>
<html>

<head>
    <title>Ananyiva Alina</title>
    <meta charset="utf-8">
    <style type="text/css">
        * {
            margin: 0px;
            padding: 0px;
            font-weight: bold;
            font-family: sans-serif;
        }

        body {
            background-color: #444;
        }
        h1{
            text-align: center;
            margin-top: 50px;
        }

        .cell {
            width: 30px;
            height: 30px;
            background-color: #acc;
            border: 1px solid black;
            display: inline-block;
            text-align: center;
        }
        .cell:hover{
            background-color: #bff;
        }

        #fieldWrapper{
            position: absolute;
            margin: 20px 0;
            padding: 10px;
            top: 50%;
            margin-top: -100px;
            left: 50%;
            margin-left: -100px;
        }

        #field {
          margin: 0 auto;
          width: 100px;
          height: 100px;
          background: black;
          padding: 20px;
          color: red;
        }
        #data, #demo{
            text-align: center;
            text-transform: uppercase;
        }
    </style>
</head>

<body>
    <h1>Where will be the dollar at the end?</h1>
    <div id="fieldWrapper">
        <div id="field"></div>
        <div id="data"></div>
        <p id="demo" onclick="game.changeCell(game.randomMoves, game.dirMain)">demonstration</p>
    </div>


    <script type="text/javascript">
        /***************************
        ***************************
        Atention!!! When you will be testing this program, just press items from console starting from first (or arr[0]). 
        Arrow show the direction of the next move. You can check array of arrows and generated numbers in console.
        First item in array is generated by programm $ holder. Everything will be visible in console. So use it for testing. 
        ***************************
        ****************************/

            var game = {
                cellsAmount: 9,
                cellsInString: 3,
                userMoves: [],
                randomMoves: [],
                dirMain: [],
                field: document.getElementById("field"),
                //Create cells. 
                createCells: function(cellsAmount, field) {
                    for (var i = 1; i < cellsAmount + 1; i++) {
                        var cell = document.createElement("div");
                        cell.setAttribute("class", "cell");
                        cell.setAttribute("id", "cell_"+i);
                        cell.innerHTML = "&nbsp;"; //Without this space - &nbsp; the indent appears.
                        field.appendChild(cell);
                    }
                },
                changeCell: function(randomMoves, dirMain){ //Random moves and arrows directions.
                    var curCell = document.getElementById("cell_"+randomMoves[0]);
                    var curDir = dirMain[0];
                    dirMain[dirMain.length] = "$"; //Instead of NaN
                    curCell.innerHTML = "$";

                    for (var i = 1; i < randomMoves.length; i++) {
                        clearDataInCell(i);
                        
                    }

                    function clearDataInCell(i) {
                        setTimeout(function(){
                            curCell.innerHTML = "&nbsp;";
                            curCell = document.getElementById("cell_"+randomMoves[i]);
                            curCell.innerHTML = dirMain[i];
                        }, 1000*i);
                    }
                },
                showArrowsAtStart: function(randomMoves, dirMain){//Does the same as function above, but shows the arrows under the table. This will be shown to the user before.
                    var curCell = document.getElementById("cell_"+randomMoves[0]);
                    var curDir = dirMain[0];
                    curCell.innerHTML = "$";

                    for (var i = 1; i < randomMoves.length-1; i++) {
                        clearDataInCell(i);
                        
                    }

                    function clearDataInCell(i) {
                        setTimeout(function(){
                            curCell.innerHTML = "&nbsp;";
                            curCell = document.getElementById("data");
                            curCell.innerHTML = dirMain[i];
                        }, 1000*i);
                    }                    
                },
                updateRandomMoves: function(randomMoves, cellsAmount, cellsInString, dirMain) {
                    var num, tempArr = [], currentNum = randomMoves[randomMoves.length-1], dirTemp=[];
                    num = Math.floor(Math.random() * cellsAmount)+1;//First time generate number.
                    randomMoves.push(num);
                    while(randomMoves.length < cellsAmount){
                        //Get last item of array and choose the next move depending on maximum choise.
                        checkMoves();
                        num = randomMoves[randomMoves.length-1];
                    }
                        
                    function checkMoves(){
                        //Check if I can move ->
                        if (num % cellsInString == 0 || num == cellsAmount) {
                            //DO NOT move ->
                        } else {
                            tempArr.push(num+1);
                            dirTemp.push("&rarr;");
                        }
                        //Check if I can move <-
                        if (num % cellsInString == 1 || num == 1) {
                            //DO NOT move <-
                        } else {
                            tempArr.push(num-1);
                            dirTemp.push("&larr;");
                        }
                        //Check if I can move \/ bottom
                        if (num > cellsAmount-cellsInString) {
                            //DO NOT move \/ bottom
                        } else {
                            tempArr.push(num+cellsInString);
                            dirTemp.push("&darr;");
                        }
                        //Check if I can move /\ top
                        if (num > cellsInString){
                            tempArr.push(num-cellsInString);
                            dirTemp.push("&uarr;");
                        }else{
                            //DO NOT move /\ top 
                        }
                        console.log(Object.entries(tempArr));
                        console.log(Object.entries(dirTemp));
                        // console.log(Object.entries(randomMoves));

                        //Choose random item of tempArr array and push to main array - randomMoves 
                        currentNum = tempArr[Math.floor(Math.random() * tempArr.length)];
                        randomMoves.push(currentNum); 
                        dirMain.push(dirTemp[tempArr.indexOf(currentNum)]);
                        //alert("dirTemp[tempArr.indexOf('currentNum')]"+dirTemp[tempArr.indexOf(currentNum)]);

                        
                        tempArr = [], dirTemp = [];
                    }
                        // alert("tempArr.length "+tempArr.length);
                        // alert("Math.floor(Math.random*tempArr.length) "+Math.floor(Math.random*tempArr.length));    
                                        

                        console.log("randomMoves "+Object.values(randomMoves));
                        console.log("dirMain "+Object.values(dirMain));
                },
                updateUserMoves: function(userMoves, randomMoves){
                    var cell = document.getElementsByClassName('cell');
                    var listenUser = function() {
                        userMoves.push(this.id.slice(5, 7));
                        //console.log(Object.values(userMoves));
                        console.log('this.id - ' + this.id.slice(5, 7));
                        if(userMoves.length == randomMoves.length){//Ones we have what to compare.
                            var curCell = document.getElementById("data");
                            //alert(Object.values(userMoves));
                            //Let's compare this arrays. If they are not the same, then computer wins.
                            for(var i = 0; i < randomMoves.length; i++){
                                console.log(randomMoves[i] +" "+ userMoves[i]);                                
                                if(randomMoves[i] != userMoves[i]){
                                    curCell.innerHTML = "Sorry. Try one more time.";
                                }else{
                                    curCell.innerHTML = "Win!";
                                }
                            }
                        }
                    }
                    for (var i=0; i < cell.length; i++) {
                        cell.item(i).onclick = listenUser;
                    }
                    

                    cell.onclick = listenUser();
                }
            };
                game.createCells(game.cellsAmount, game.field);
                game.updateRandomMoves(game.randomMoves, game.cellsAmount, game.cellsInString, game.dirMain);
                game.showArrowsAtStart(game.randomMoves, game.dirMain);
                //game.changeCell(game.randomMoves, game.dirMain);
                game.updateUserMoves(game.userMoves, game.randomMoves);



    </script>

</body>

</html>
